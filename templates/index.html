<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Strategic Consultant</title>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#0d1117">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: '#0d1117',
                        surface: '#161b22',
                        primary: '#58a6ff',
                        secondary: '#8b949e',
                        accent: '#a371f7',
                        neonBlue: '#00f3ff',
                        neonPurple: '#bc13fe',
                        success: '#238636',
                        warning: '#d29922',
                        danger: '#f85149',
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                        inter: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 3s linear infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: 'Cairo', sans-serif;
            overflow-x: hidden;
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(22, 27, 34, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(48, 54, 61, 0.5);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .glass-panel:hover {
            border-color: rgba(88, 166, 255, 0.4);
            box-shadow: 0 0 15px rgba(88, 166, 255, 0.1);
        }

        /* Neon Borders */
        .neon-border-blue {
            border: 1px solid rgba(0, 243, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.1), inset 0 0 5px rgba(0, 243, 255, 0.05);
        }
        .neon-border-purple {
            border: 1px solid rgba(188, 19, 254, 0.3);
            box-shadow: 0 0 10px rgba(188, 19, 254, 0.1), inset 0 0 5px rgba(188, 19, 254, 0.05);
        }

        /* Diamond Topology CSS */
        .diamond-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            position: relative;
            padding: 2rem;
        }
        .node {
            width: 50px;
            height: 50px;
            background: rgba(13, 17, 23, 0.9);
            border: 2px solid #58a6ff;
            transform: rotate(45deg);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
            position: relative;
            z-index: 10;
            box-shadow: 0 0 10px rgba(88, 166, 255, 0.2);
        }
        .node-icon {
            transform: rotate(-45deg);
            font-size: 1.2rem;
            color: #58a6ff;
        }
        .node.active {
            border-color: #00f3ff;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
            background: rgba(0, 243, 255, 0.1);
        }
        .connection-line {
            position: absolute;
            height: 2px;
            background: #30363d;
            transition: all 0.5s ease;
            z-index: 1;
        }
        .connection-line.active {
            background: linear-gradient(90deg, #00f3ff, #bc13fe);
            box-shadow: 0 0 8px rgba(0, 243, 255, 0.4);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0d1117; 
        }
        ::-webkit-scrollbar-thumb {
            background: #30363d; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #58a6ff; 
        }

        /* Typewriter Cursor */
        .typewriter-cursor::after {
            content: '|';
            animation: blink 1s step-end infinite;
            color: #58a6ff;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Progress Bar */
        .progress-bg {
            background: #21262d;
            border-radius: 999px;
            overflow: hidden;
            height: 8px;
        }
        .progress-fill {
            height: 100%;
            border-radius: 999px;
            transition: width 1.5s ease-out;
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Top Navigation -->
    <nav class="glass-panel sticky top-0 z-50 border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded bg-gradient-to-tr from-blue-500 to-purple-600 flex items-center justify-center shadow-lg shadow-purple-900/50">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <span class="font-bold text-xl tracking-tight text-white" id="nav-title">AI Strategic Consultant</span>
                </div>
                
                <div class="flex items-center gap-4">
                    <select id="lang-switcher" class="bg-gray-800 text-sm rounded-lg border border-gray-700 text-gray-300 px-3 py-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all">
                        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="en">English</option>
                        <option value="de">Deutsch</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-7xl">
        
        <!-- Input Section -->
        <section id="input-section" class="mb-12 text-center max-w-3xl mx-auto">
            <h1 class="text-4xl sm:text-5xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 pb-2 leading-tight" id="hero-title">
                Strategic Intelligence
            </h1>
            <p class="text-gray-400 mb-8 text-lg" id="hero-subtitle">Advanced multi-agent analysis for high-stakes decision making.</p>
            
            <div class="glass-panel rounded-2xl p-1 neon-border-blue transition-all duration-300 focus-within:ring-2 focus-within:ring-blue-500/50 relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <textarea id="business-idea" rows="4" 
                    class="w-full bg-[#0d1117] text-white p-4 rounded-xl outline-none resize-none placeholder-gray-600 text-lg relative z-10"
                    placeholder="Describe your business idea or strategic challenge here..."></textarea>
                <div class="flex justify-between items-center p-3 bg-[#161b22]/80 border-t border-gray-800 relative z-10">
                    <span class="text-xs text-gray-500" id="input-hint">AI Agents ready</span>
                    <button id="analyze-btn" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg shadow-purple-900/30 transform hover:-translate-y-0.5 transition-all flex items-center gap-2">
                        <span id="btn-text">Initialize Analysis</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Visualization: Diamond Topology -->
        <section id="topology-viz" class="mb-12 hidden opacity-0 transition-opacity duration-1000">
            <div class="flex justify-center mb-4">
                <span class="text-xs font-mono text-blue-400 uppercase tracking-widest border border-blue-900 px-2 py-1 rounded">System Architecture</span>
            </div>
            <div class="diamond-container h-48 w-full max-w-2xl mx-auto">
                <!-- User Input Node -->
                <div class="node" id="node-input">
                    <div class="node-icon">ðŸ’¡</div>
                </div>
                
                <!-- Divergence Lines -->
                <div class="connection-line w-24 transform -rotate-12 origin-left" style="left: 50%; top: 50%; width: 100px; transform: translate(-140px, 0) rotate(-20deg);"></div>
                <div class="connection-line w-24 transform rotate-12 origin-left" style="left: 50%; top: 50%; width: 100px; transform: translate(-140px, 0) rotate(0deg);"></div>
                <div class="connection-line w-24 transform rotate-12 origin-left" style="left: 50%; top: 50%; width: 100px; transform: translate(-140px, 0) rotate(20deg);"></div>

                <!-- Parallel Agents -->
                <div class="flex flex-col gap-8">
                    <div class="node" id="node-market"><div class="node-icon">M</div></div>
                    <div class="node" id="node-finance"><div class="node-icon">F</div></div>
                    <div class="node" id="node-comp"><div class="node-icon">C</div></div>
                </div>

                <!-- Convergence Lines -->
                
                <!-- Synthesis Node -->
                <div class="node" id="node-synth">
                    <div class="node-icon">ðŸ§ </div>
                </div>
            </div>
            <div class="text-center text-sm text-gray-500 mt-2 animate-pulse" id="status-text">Waiting for input...</div>
        </section>

        <!-- Results Section -->
        <div id="results-container" class="hidden space-y-8">
            
            <!-- Strategic Memo (Full Width) -->
            <div class="glass-panel rounded-2xl p-1 neon-border-purple fade-in" style="animation-delay: 0.1s;">
                <div class="bg-gradient-to-r from-[#1f1226] to-[#0d1117] rounded-xl p-6 sm:p-8">
                    <div class="flex justify-between items-start mb-6 border-b border-gray-800 pb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-white mb-1 flex items-center gap-2">
                                <span class="text-purple-400">#</span> <span id="memo-title">Strategic Memo</span>
                            </h2>
                            <p class="text-sm text-gray-400 font-mono">ID: <span id="memo-id">REQ-8X29</span> â€¢ CLASS: CONFIDENTIAL</p>
                        </div>
                        <div class="flex gap-2">
                            <span class="px-3 py-1 rounded-full text-xs font-bold bg-gray-800 text-gray-300 border border-gray-700" id="memo-date">2026-02-09</span>
                        </div>
                    </div>

                    <div class="prose prose-invert max-w-none mb-8">
                        <div class="bg-[#13151a] p-6 rounded-lg border-l-4 border-purple-500 shadow-inner">
                            <h3 class="text-lg font-semibold text-purple-300 mb-2" id="exec-summary-title">Executive Summary</h3>
                            <p id="executive-summary" class="text-gray-300 leading-relaxed typewriter-target"></p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Risk & Confidence -->
                        <div class="bg-[#161b22] p-4 rounded-lg border border-gray-800">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-400 text-sm" id="risk-label">Overall Risk Level</span>
                                <span id="risk-val" class="text-sm font-bold text-yellow-400">Calculating...</span>
                            </div>
                            <div class="progress-bg mb-4">
                                <div id="risk-bar" class="progress-fill bg-yellow-500 w-0"></div>
                            </div>

                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-400 text-sm" id="conf-label">Confidence Score</span>
                                <span id="conf-val" class="text-sm font-bold text-blue-400">0%</span>
                            </div>
                            <div class="progress-bg">
                                <div id="conf-bar" class="progress-fill bg-blue-500 w-0"></div>
                            </div>
                        </div>

                        <!-- Final Recommendation -->
                        <div class="bg-[#161b22] p-4 rounded-lg border border-green-900/30 relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-2 opacity-10">
                                <svg class="w-16 h-16 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            </div>
                            <h3 class="text-green-400 font-bold mb-2 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span id="rec-title">Recommendation</span>
                            </h3>
                            <p id="final-recommendation" class="text-gray-200 text-sm italic typewriter-target"></p>
                        </div>
                    </div>
                    
                    <!-- Conflict Resolution -->
                    <div class="mt-6 border-t border-gray-800 pt-6">
                         <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3" id="conflict-title">Conflict Resolution Protocol</h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                             <div class="p-3 rounded bg-red-900/10 border border-red-900/30 text-red-200">
                                 <strong class="block mb-1 text-red-400">Conflicts Identified:</strong>
                                 <span id="conflicts-text" class="typewriter-target"></span>
                             </div>
                             <div class="p-3 rounded bg-yellow-900/10 border border-yellow-900/30 text-yellow-200">
                                 <strong class="block mb-1 text-yellow-400">Resolution Rationale:</strong>
                                 <span id="rationale-text" class="typewriter-target"></span>
                             </div>
                         </div>
                    </div>
                </div>
            </div>

            <!-- 3 Columns: Agent Details -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Market Agent -->
                <div class="glass-panel rounded-xl p-5 border-t-4 border-green-500 fade-in" style="animation-delay: 0.2s;">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 rounded-full bg-green-900/50 flex items-center justify-center text-green-400 font-bold">M</div>
                        <h3 class="font-bold text-white" id="market-title">Market Logic</h3>
                    </div>
                    <div class="space-y-4 text-sm text-gray-300">
                        <div><span class="text-gray-500 block text-xs uppercase" id="market-demand">Market Demand</span> <span id="market-demand-val" class="typewriter-target"></span></div>
                        <div><span class="text-gray-500 block text-xs uppercase" id="market-segments">Segments</span> <span id="market-segments-val" class="typewriter-target"></span></div>
                        <div><span class="text-gray-500 block text-xs uppercase" id="market-trends">Trends</span> <span id="market-trends-val" class="typewriter-target"></span></div>
                    </div>
                </div>

                <!-- Financial Agent -->
                <div class="glass-panel rounded-xl p-5 border-t-4 border-blue-500 fade-in" style="animation-delay: 0.3s;">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 rounded-full bg-blue-900/50 flex items-center justify-center text-blue-400 font-bold">F</div>
                        <h3 class="font-bold text-white" id="financial-title">Financial Sustainability</h3>
                    </div>
                    <div class="space-y-4 text-sm text-gray-300">
                        <div><span class="text-gray-500 block text-xs uppercase" id="fin-unit">Unit Economics</span> <span id="fin-unit-val" class="typewriter-target"></span></div>
                        <div><span class="text-gray-500 block text-xs uppercase" id="fin-costs">Op Costs</span> <span id="fin-costs-val" class="typewriter-target"></span></div>
                        <div><span class="text-gray-500 block text-xs uppercase" id="fin-revenue">Revenue</span> <span id="fin-revenue-val" class="typewriter-target"></span></div>
                    </div>
                </div>

                <!-- Competitive Agent -->
                <div class="glass-panel rounded-xl p-5 border-t-4 border-purple-500 fade-in" style="animation-delay: 0.4s;">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 rounded-full bg-purple-900/50 flex items-center justify-center text-purple-400 font-bold">C</div>
                        <h3 class="font-bold text-white" id="comp-title">Competitive Durability</h3>
                    </div>
                    <div class="space-y-4 text-sm text-gray-300">
                        <div><span class="text-gray-500 block text-xs uppercase" id="comp-barriers">Barriers</span> <span id="comp-barriers-val" class="typewriter-target"></span></div>
                        <div><span class="text-gray-500 block text-xs uppercase" id="comp-moat">Moat</span> <span id="comp-moat-val" class="typewriter-target"></span></div>
                        <div><span class="text-gray-500 block text-xs uppercase" id="comp-value">Value Prop</span> <span id="comp-value-val" class="typewriter-target"></span></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- PWA Install Prompt (Hidden by default) -->
    <div id="pwa-install" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-[#161b22] border border-blue-500/30 rounded-lg p-4 shadow-2xl z-50 transform translate-y-32 transition-transform duration-500 flex items-center justify-between">
        <div class="flex items-center gap-3">
             <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                 <span class="text-white font-bold">AI</span>
             </div>
             <div>
                 <p class="text-white font-bold text-sm">Install App</p>
                 <p class="text-gray-400 text-xs">Add to Home Screen</p>
             </div>
        </div>
        <button id="install-btn" class="text-blue-400 font-bold text-sm px-3 py-1 hover:bg-blue-900/20 rounded">Install</button>
        <button id="close-install" class="text-gray-500 hover:text-white ml-2">&times;</button>
    </div>

    <!-- Scripts -->
    <script>
        // Translations
        const translations = {
            en: {
                dir: 'ltr',
                title: 'AI Strategic Consultant',
                subtitle: 'Advanced multi-agent analysis for high-stakes decision making.',
                placeholder: 'Describe your business idea or strategic challenge here...',
                hint: 'AI Agents ready',
                btn: 'Initialize Analysis',
                status: 'Waiting for input...',
                statusProcessing: 'Agents Processing...',
                memoTitle: 'Strategic Memo',
                execTitle: 'Executive Summary',
                risk: 'Overall Risk Level',
                confidence: 'Confidence Score',
                recTitle: 'Recommendation',
                conflictTitle: 'Conflict Resolution Protocol',
                conflicts: 'Conflicts Identified',
                rationale: 'Resolution Rationale',
                market: 'Market Logic',
                marketDemand: 'Market Demand',
                marketSegments: 'Segments',
                marketTrends: 'Trends',
                financial: 'Financial Sustainability',
                finUnit: 'Unit Economics',
                finCosts: 'Op Costs',
                finRevenue: 'Revenue',
                comp: 'Competitive Durability',
                compBarriers: 'Barriers',
                compMoat: 'Moat',
                compValue: 'Value Prop',
                font: 'Inter'
            },
            ar: {
                dir: 'rtl',
                title: 'Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ø§Ù„Ø°ÙƒÙŠ',
                subtitle: 'ØªØ­Ù„ÙŠÙ„ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ù„Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…ØµÙŠØ±ÙŠØ©.',
                placeholder: 'ØµÙ ÙÙƒØ±ØªÙƒ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© Ø£Ùˆ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ù‡Ù†Ø§...',
                hint: 'Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø¬Ø§Ù‡Ø²ÙˆÙ†',
                btn: 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„',
                status: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª...',
                statusProcessing: 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡...',
                memoTitle: 'Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©',
                execTitle: 'Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ',
                risk: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© Ø§Ù„Ø¹Ø§Ù…',
                confidence: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø«Ù‚Ø©',
                recTitle: 'Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©',
                conflictTitle: 'Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª',
                conflicts: 'Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©',
                rationale: 'Ù…Ø¨Ø±Ø±Ø§Øª Ø§Ù„Ø­Ù„',
                market: 'Ù…Ù†Ø·Ù‚ Ø§Ù„Ø³ÙˆÙ‚',
                marketDemand: 'Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø³ÙˆÙ‚ÙŠ',
                marketSegments: 'Ø§Ù„Ø´Ø±Ø§Ø¦Ø­',
                marketTrends: 'Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª',
                financial: 'Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
                finUnit: 'Ø§Ù‚ØªØµØ§Ø¯ÙŠØ§Øª Ø§Ù„ÙˆØ­Ø¯Ø©',
                finCosts: 'Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©',
                finRevenue: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª',
                comp: 'Ø§Ù„Ù…ØªØ§Ù†Ø© Ø§Ù„ØªÙ†Ø§ÙØ³ÙŠØ©',
                compBarriers: 'Ø§Ù„Ø­ÙˆØ§Ø¬Ø²',
                compMoat: 'Ø§Ù„Ø®Ù†Ø¯Ù‚ Ø§Ù„Ø¯ÙØ§Ø¹ÙŠ',
                compValue: 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©',
                font: 'Cairo'
            },
            de: {
                dir: 'ltr',
                title: 'KI Strategieberater',
                subtitle: 'Fortschrittliche Multi-Agenten-Analyse fÃ¼r wichtige Entscheidungen.',
                placeholder: 'Beschreiben Sie hier Ihre GeschÃ¤ftsidee...',
                hint: 'KI-Agenten bereit',
                btn: 'Analyse starten',
                status: 'Warte auf Eingabe...',
                statusProcessing: 'Agenten verarbeiten...',
                memoTitle: 'Strategisches Memo',
                execTitle: 'Zusammenfassung',
                risk: 'Gesamtrisiko',
                confidence: 'Konfidenzwert',
                recTitle: 'Empfehlung',
                conflictTitle: 'KonfliktlÃ¶sungsprotokoll',
                conflicts: 'Identifizierte Konflikte',
                rationale: 'LÃ¶sungsbegrÃ¼ndung',
                market: 'Marktlogik',
                marketDemand: 'Marktnachfrage',
                marketSegments: 'Segmente',
                marketTrends: 'Trends',
                financial: 'Finanzielle Nachhaltigkeit',
                finUnit: 'EinheitsÃ¶konomie',
                finCosts: 'Betriebskosten',
                finRevenue: 'Einnahmen',
                comp: 'WettbewerbsfÃ¤higkeit',
                compBarriers: 'Barrieren',
                compMoat: 'Burggraben',
                compValue: 'Wertversprechen',
                font: 'Inter'
            }
        };

        // State
        let currentLang = 'ar';
        const els = {
            html: document.documentElement,
            navTitle: document.getElementById('nav-title'),
            heroTitle: document.getElementById('hero-title'),
            heroSubtitle: document.getElementById('hero-subtitle'),
            input: document.getElementById('business-idea'),
            inputHint: document.getElementById('input-hint'),
            btn: document.getElementById('analyze-btn'),
            btnText: document.getElementById('btn-text'),
            status: document.getElementById('status-text'),
            // ... (map all IDs)
        };

        // Language Switcher
        document.getElementById('lang-switcher').addEventListener('change', (e) => {
            setLanguage(e.target.value);
        });

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            // RTL/LTR
            els.html.dir = t.dir;
            els.html.lang = lang;
            document.body.style.fontFamily = t.font === 'Cairo' ? "'Cairo', sans-serif" : "'Inter', sans-serif";

            // Update Text
            els.navTitle.innerText = t.title;
            els.heroTitle.innerText = t.title; // Reuse title or subtitle logic if preferred
            els.heroSubtitle.innerText = t.subtitle;
            els.input.placeholder = t.placeholder;
            els.inputHint.innerText = t.hint;
            els.btnText.innerText = t.btn;
            els.status.innerText = t.status;

            // Update Result Labels
            document.getElementById('memo-title').innerText = t.memoTitle;
            document.getElementById('exec-summary-title').innerText = t.execTitle;
            document.getElementById('risk-label').innerText = t.risk;
            document.getElementById('conf-label').innerText = t.confidence;
            document.getElementById('rec-title').innerText = t.recTitle;
            document.getElementById('conflict-title').innerText = t.conflictTitle;
            document.getElementById('market-title').innerText = t.market;
            document.getElementById('market-demand').innerText = t.marketDemand;
            document.getElementById('market-segments').innerText = t.marketSegments;
            document.getElementById('market-trends').innerText = t.marketTrends;
            document.getElementById('financial-title').innerText = t.financial;
            document.getElementById('fin-unit').innerText = t.finUnit;
            document.getElementById('fin-costs').innerText = t.finCosts;
            document.getElementById('fin-revenue').innerText = t.finRevenue;
            document.getElementById('comp-title').innerText = t.comp;
            document.getElementById('comp-barriers').innerText = t.compBarriers;
            document.getElementById('comp-moat').innerText = t.compMoat;
            document.getElementById('comp-value').innerText = t.compValue;
            
            // Re-update conflicts/rationale headers if needed (though they are static in HTML structure, their text content spans need IDs if labels change)
            // Added explicit IDs for strong tags in conflict section if strictly needed, but text replacement is easier on spans.
            // For now, assume users understand "Conflicts Identified" header or map it.
        }

        // Initialize Language
        setLanguage('ar'); // Default per prompt requirement (AR | EN | DE implies sequence or priority, but AR is often default in such requests)
        // Wait, the prompt says "Multilingual Support (AR | EN | DE)". I'll set AR as default since the backend is Arabic.

        // Typewriter Effect
        async function typeWriter(elementId, text, speed = 10) {
            const el = document.getElementById(elementId);
            if (!el) return;
            el.innerHTML = '';
            el.classList.add('typewriter-cursor');
            
            for (let i = 0; i < text.length; i++) {
                el.innerHTML += text.charAt(i);
                if (text.charAt(i) === ' ' || text.charAt(i) === '.') {
                     await new Promise(r => setTimeout(r, speed * 2)); // Pause at natural breaks
                } else {
                     await new Promise(r => setTimeout(r, speed));
                }
            }
            el.classList.remove('typewriter-cursor');
        }

        // Analyze Function
        document.getElementById('analyze-btn').addEventListener('click', async () => {
            const idea = document.getElementById('business-idea').value;
            if (!idea) return;

            // UI State: Loading
            const t = translations[currentLang];
            document.getElementById('topology-viz').classList.remove('hidden');
            setTimeout(() => document.getElementById('topology-viz').classList.remove('opacity-0'), 100);
            document.getElementById('results-container').classList.add('hidden');
            document.getElementById('status-text').innerText = t.statusProcessing;
            
            // Animate Nodes
            const nodes = document.querySelectorAll('.node');
            nodes.forEach(n => n.classList.add('animate-pulse'));

            try {
                const res = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idea })
                });
                
                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.message || 'Analysis failed');
                }
                
                // Stop Loading Animation
                nodes.forEach(n => n.classList.remove('animate-pulse'));
                nodes.forEach(n => n.classList.add('active')); // Keep them lit
                
                // Show Results
                document.getElementById('results-container').classList.remove('hidden');
                
                // Populate Data with Typewriter
                // Synthesis
                typeWriter('executive-summary', data.strategic_memo.executive_summary);
                typeWriter('final-recommendation', data.strategic_memo.final_recommendation);
                typeWriter('conflicts-text', data.strategic_memo.conflicts_identified);
                typeWriter('rationale-text', data.strategic_memo.resolution_rationale);
                
                // Metrics
                const risk = data.strategic_memo.overall_risk_level;
                const conf = data.strategic_memo.overall_confidence_score;
                
                document.getElementById('risk-val').innerText = risk;
                document.getElementById('conf-val').innerText = Math.round(conf * 100) + '%';
                
                // Bars animation
                setTimeout(() => {
                    document.getElementById('risk-bar').style.width = risk === 'Ø¹Ø§Ù„ÙŠ' ? '90%' : (risk === 'Ù…ØªÙˆØ³Ø·' ? '50%' : '20%');
                    document.getElementById('risk-bar').className = `progress-fill w-0 ${risk === 'Ø¹Ø§Ù„ÙŠ' ? 'bg-red-500' : (risk === 'Ù…ØªÙˆØ³Ø·' ? 'bg-yellow-500' : 'bg-green-500')}`;
                    
                    document.getElementById('conf-bar').style.width = (conf * 100) + '%';
                }, 500);

                // Agents
                const m = data.market_analysis;
                typeWriter('market-demand-val', m.market_demand);
                typeWriter('market-segments-val', m.customer_segments);
                typeWriter('market-trends-val', m.market_trends);

                const f = data.financial_analysis;
                typeWriter('fin-unit-val', f.unit_economics);
                typeWriter('fin-costs-val', f.operational_costs);
                typeWriter('fin-revenue-val', f.revenue_streams);

                const c = data.competitive_analysis;
                typeWriter('comp-barriers-val', c.entry_barriers);
                typeWriter('comp-moat-val', c.moat_strength);
                typeWriter('comp-value-val', c.unique_value_proposition);

            } catch (err) {
                console.error(err);
                // Stop Loading Animation on error
                nodes.forEach(n => n.classList.remove('animate-pulse'));
                document.getElementById('status-text').innerText = 'Analysis Failed';
                alert(`Error: ${err.message}`);
            }
        });

        // PWA Install Logic
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installPanel = document.getElementById('pwa-install');
            installPanel.classList.remove('translate-y-32');
            
            document.getElementById('install-btn').addEventListener('click', () => {
                installPanel.classList.add('translate-y-32');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                });
            });
            
            document.getElementById('close-install').addEventListener('click', () => {
                installPanel.classList.add('translate-y-32');
            });
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }
    </script>
</body>
</html>